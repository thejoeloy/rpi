#include <stdio.h>
#include <alsa/asoundlib.h>

void print_device_info(snd_ctl_t *ctl, const char *name) {
    snd_pcm_info_t *info;
    snd_pcm_info_alloca(&info);

    if (snd_ctl_pcm_info(ctl, info) < 0) {
        printf("Error getting device info for %s\n", name);
        return;
    }

    const char *device_name = snd_pcm_info_get_name(info);
    const char *device_id = snd_pcm_info_get_id(info);
    snd_pcm_stream_t stream_type = snd_pcm_info_get_stream(info);

    printf("\nDevice: %s (%s)\n", device_name, device_id);
    printf("Type: %s\n", (stream_type == SND_PCM_STREAM_CAPTURE) ? "Capture" : "Playback");
    printf("Device ID: %s\n", device_id);
}

void list_devices() {
    snd_ctl_card_info_t *card_info;
    snd_ctl_card_info_alloca(&card_info);

    int card = -1;
    while (snd_card_next(&card) >= 0 && card >= 0) {
        snd_ctl_t *ctl;
        
        // Get the name of the card (e.g., "hw:0", "hw:1")
        char card_name[32];
        snprintf(card_name, sizeof(card_name), "hw:%d", card);

        if (snd_ctl_open(&ctl, card_name, 0) < 0) {
            continue;
        }

        snd_ctl_card_info(ctl, card_info);
        const char *card_display_name = snd_ctl_card_info_get_name(card_info);

        printf("\nCard %d: %s\n", card, card_display_name);

        snd_pcm_info_t *info;
        snd_pcm_info_alloca(&info);
        for (snd_pcm_stream_t stream = SND_PCM_STREAM_PLAYBACK; stream <= SND_PCM_STREAM_CAPTURE; stream++) {
            if (snd_ctl_pcm_info(ctl, info) == 0) {
                print_device_info(ctl, card_display_name);
            }
        }

        snd_ctl_close(ctl);
    }
}

int main() {
    printf("Listing audio capture and playback devices:\n");
    list_devices();
    return 0;
}

